//------------------------------------------------------------------------------------
// Includes
//------------------------------------------------------------------------------------
#include <c8051f000.h>                    // SFR declarations

//------------------------------------------------------------------------------------
// Global CONSTANTS
//------------------------------------------------------------------------------------
sbit LED = P1^6;                          // Green LED: '1' = ON; '0' = OFF

//------------------------------------------------------------------------------------
// Function PROTOTYPES
//------------------------------------------------------------------------------------
void PORT_Init(void);

//------------------------------------------------------------------------------------
// MAIN Routine
//------------------------------------------------------------------------------------
void main (void) {

   // Disable watchdog timer
   WDTCN = 0xde;
   WDTCN = 0xad;

   PORT_Init();                           // Set up Crossbar and GPIO

   EA = 1;                                // Enable global interrupts

   LED = 1;                               // Turn on LED 

   while (1) {
      // Infinite loop to keep the program running
   }
}

//------------------------------------------------------------------------------------
// PORT_Init
//------------------------------------------------------------------------------------
//
// This routine initializes the Crossbar and GPIO pins
//
// Pinout:  
//    P1.6 - LED (GPIO)
//
void PORT_Init(void)
{
   XBR2 = 0x40;                           // Enable crossbar and weak pull-ups

   PRT1CF |= 0x40;                        // Enable P1.6 (LED) as a push-pull output
}
コードの説明
インクルードセクション:

c
コードをコピーする
#include <c8051f000.h>
必要なレジスタ定義を含むヘッダファイルをインクルードします。
グローバル定数:

c
コードをコピーする
sbit LED = P1^6;
P1.6ピンをLEDにマッピングします。
関数プロトタイプ:

c
コードをコピーする
void PORT_Init(void);
PORT_Init関数のプロトタイプを宣言します。
メインルーチン:

c
コードをコピーする
void main (void) {
   WDTCN = 0xde;
   WDTCN = 0xad;

   PORT_Init(); // GPIO設定
   EA = 1; // グローバル割り込みを有効化
   LED = 1; // LED点灯

   while (1) {
      // プログラムを実行し続ける無限ループ
   }
}
